{"version":3,"sources":["../../src/server/AsteroidsServerEngine.js"],"names":["AsteroidsServerEngine","io","gameEngine","inputOptions","physicsEngine","world","on","handleCollision","bind","shoot","playerReady","playerGroups","addAsteroids","addFinishLine","evt","A","B","forEachObject","id","obj","physicsObj","bodyA","bodyB","trace","toString","Bullet","Asteroid","explode","Ship","kill","FinishLine","gameWon","queryObjects","instanceType","length","player","radius","shapes","angle","Math","PI","bullet","mass","position","TwoVector","cos","sin","velocity","angularVelocity","addObjectToWorld","timer","add","bulletLifeTime","destroyBullet","bulletId","objects","removeObjectFromWorld","ship","console","log","playerId","c_playerName","c_playerID","v_playerName","v_playerID","pid","lives","addShip","won","groupCode","c_socketID","to","emit","v_socketID","socket","that","data","connectedPlayers","playerName","privateCode","full","viewer","sendGroupUpdate","c_ready","v_ready","gameStarted","group","ship_pid","socketId","group_code","o","ServerEngine"],"mappings":"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","sourcesContent":["import { ServerEngine, TwoVector } from 'lance-gg';\r\nimport Asteroid from '../common/Asteroid';\r\nimport Bullet from '../common/Bullet';\r\nimport Ship from '../common/Ship';\r\nimport FinishLine from \"../common/FinishLine\";\r\n\r\nexport default class AsteroidsServerEngine extends ServerEngine {\r\n\r\n    constructor(io, gameEngine, inputOptions) {\r\n        super(io, gameEngine, inputOptions);\r\n        gameEngine.physicsEngine.world.on('beginContact', this.handleCollision.bind(this));\r\n        gameEngine.on('shoot', this.shoot.bind(this));\r\n        this.playerReady = {}\r\n        this.playerGroups = {}\r\n        this.io = io;\r\n    }\r\n\r\n    start() {\r\n        super.start();\r\n        this.gameEngine.addAsteroids();\r\n        this.gameEngine.addFinishLine();\r\n    }\r\n\r\n    // handle a collision on server only\r\n    handleCollision(evt) {\r\n\r\n        // identify the two objects which collided\r\n        let A;\r\n        let B;\r\n        this.gameEngine.world.forEachObject((id, obj) => {\r\n            if (obj.physicsObj === evt.bodyA) A = obj;\r\n            if (obj.physicsObj === evt.bodyB) B = obj;\r\n        });\r\n\r\n        // check bullet-asteroid and ship-asteroid collisions\r\n        if (!A || !B) return;\r\n        this.gameEngine.trace.trace(() => `collision between A=${A.toString()}`);\r\n        this.gameEngine.trace.trace(() => `collision and     B=${B.toString()}`);\r\n        if (A instanceof Bullet && B instanceof Asteroid) this.gameEngine.explode(B, A);\r\n        if (B instanceof Bullet && A instanceof Asteroid) this.gameEngine.explode(A, B);\r\n        if (A instanceof Ship && B instanceof Asteroid) this.kill(A);\r\n        if (B instanceof Ship && A instanceof Asteroid) this.kill(B);\r\n        if (A instanceof Ship && B instanceof FinishLine) this.gameWon(A);\r\n        if (B instanceof Ship && A instanceof FinishLine) this.gameWon(B);\r\n\r\n        // restart game\r\n        if (this.gameEngine.world.queryObjects({ instanceType: Asteroid }).length === 0) this.gameEngine.addAsteroids();\r\n    }\r\n\r\n    // shooting creates a bullet\r\n    shoot(player) {\r\n\r\n        let radius = player.physicsObj.shapes[0].radius;\r\n        let angle = player.physicsObj.angle + Math.PI / 2;\r\n        let bullet = new Bullet(this.gameEngine, {}, {\r\n            mass: 0.05,\r\n            position: new TwoVector(\r\n                radius * Math.cos(angle) + player.physicsObj.position[0],\r\n                radius * Math.sin(angle) + player.physicsObj.position[1]\r\n            ),\r\n            velocity: new TwoVector(\r\n                2 * Math.cos(angle) + player.physicsObj.velocity[0],\r\n                2 * Math.sin(angle) + player.physicsObj.velocity[1]\r\n            ),\r\n            angularVelocity: 0\r\n        });\r\n        let obj = this.gameEngine.addObjectToWorld(bullet);\r\n        this.gameEngine.timer.add(this.gameEngine.bulletLifeTime, this.destroyBullet, this, [obj.id]);\r\n    }\r\n\r\n    // destroy the missile if it still exists\r\n    destroyBullet(bulletId) {\r\n        if (this.gameEngine.world.objects[bulletId]) {\r\n            this.gameEngine.trace.trace(() => `bullet[${bulletId}] destroyed`);\r\n            this.gameEngine.removeObjectFromWorld(bulletId);\r\n        }\r\n    }\r\n\r\n    kill(ship) {\r\n        console.log(ship.playerId)\r\n        console.log(ship.c_playerName)\r\n        console.log(ship.c_playerID)\r\n        console.log(ship.v_playerName)\r\n        console.log(ship.v_playerID)\r\n        console.log(\"end\")\r\n        let pid = ship.playerId\r\n        if(ship.lives-- === 0) this.gameEngine.removeObjectFromWorld(ship.id);\r\n        this.gameEngine.addShip(pid);\r\n        //here\r\n    }\r\n\r\n    gameWon(ship) {\r\n        ship.won = true;\r\n    }\r\n\r\n    sendGroupUpdate(groupCode) {\r\n        if (groupCode) {\r\n            if (this.playerGroups[groupCode].c_socketID) {\r\n                this.io.to(this.playerGroups[groupCode].c_socketID).emit('groupUpdate', this.playerGroups[groupCode]);\r\n            }\r\n            if (this.playerGroups[groupCode].v_socketID) {\r\n                this.io.to(this.playerGroups[groupCode].v_socketID).emit('groupUpdate', this.playerGroups[groupCode]);\r\n            }\r\n        }\r\n    }\r\n\r\n    onPlayerConnected(socket) {\r\n        super.onPlayerConnected(socket);\r\n        let that = this;\r\n        socket.on('playerDataUpdate', function(data) {\r\n            that.connectedPlayers[socket.id].playerName = data.playerName;\r\n            that.connectedPlayers[socket.id].privateCode = data.privateCode;\r\n            if (data.privateCode in that.playerGroups) {\r\n                if (that.playerGroups[data.privateCode].full) {\r\n                    socket.emit('groupFull');\r\n                } else {\r\n                    if (that.playerGroups[data.privateCode].v_playerID === null) {\r\n                        that.playerGroups[data.privateCode].v_playerID = socket.playerId;\r\n                        that.playerGroups[data.privateCode].v_playerName = data.playerName;\r\n                        that.playerGroups[data.privateCode].v_socketID = socket.id;\r\n                        that.playerGroups[data.privateCode].full = true;\r\n                        socket.emit('waitingForPlayer', {\r\n                            viewer : true\r\n                        });\r\n                        that.sendGroupUpdate(data.privateCode);\r\n                    } else {\r\n                        that.playerGroups[data.privateCode].c_playerID = socket.playerId;\r\n                        that.playerGroups[data.privateCode].c_playerName = data.playerName;\r\n                        that.playerGroups[data.privateCode].c_socketID = socket.id;\r\n                        that.playerGroups[data.privateCode].full = true;\r\n                        socket.emit('waitingForPlayer', {\r\n                            viewer : false\r\n                        });\r\n                        that.sendGroupUpdate(data.privateCode);\r\n                    }\r\n                }\r\n            } else {\r\n                that.playerGroups[data.privateCode] = {\r\n                    c_playerID : socket.playerId,\r\n                    c_playerName : data.playerName,\r\n                    c_socketID : socket.id,\r\n                    v_playerID : null,\r\n                    v_playerName : null,\r\n                    v_socketID : null,\r\n                    full : false,\r\n                    c_ready : false,\r\n                    v_ready : false,\r\n                    gameStarted: false\r\n                };\r\n                socket.emit('waitingForPlayer', {\r\n                    viewer : false\r\n                });\r\n                that.sendGroupUpdate(data.privateCode);\r\n            }\r\n        });\r\n\r\n        socket.on('playerReady', function(data) {\r\n            let groupCode = that.connectedPlayers[socket.id].privateCode;\r\n            if (data.viewer) {\r\n                that.playerGroups[groupCode].v_ready = true;\r\n            } else {\r\n                that.playerGroups[groupCode].c_ready = true;\r\n            }\r\n            that.sendGroupUpdate(groupCode);\r\n            let group = that.playerGroups[that.connectedPlayers[socket.id].privateCode];\r\n            if (group.v_ready && group.c_ready) {\r\n                that.gameEngine.addShip(group.c_playerID);\r\n                that.gameEngine.playerReady[group.c_playerID] = true;\r\n                that.io.to(group.c_socketID).to(group.v_socketID).emit('gameBegin', {ship_pid : group.c_playerID});\r\n                that.playerGroups[that.connectedPlayers[socket.id].privateCode].gameStarted = true;\r\n            }\r\n        });\r\n    }\r\n\r\n    onPlayerDisconnected(socketId, playerId) {\r\n        let group_code = this.connectedPlayers[socketId].privateCode;\r\n        super.onPlayerDisconnected(socketId, playerId);\r\n        //console.log('Player from ' + group_code + ' is being deleted');\r\n        //console.log(this.playerGroups[group_code]);\r\n        if (group_code && this.playerGroups[group_code]) {\r\n            if (playerId === this.playerGroups[group_code].c_playerID) {\r\n                this.playerGroups[group_code].c_playerID = null;\r\n                this.playerGroups[group_code].c_socketID = null;\r\n                this.playerGroups[group_code].c_playerName = null;\r\n                this.playerGroups[group_code].c_ready = false;\r\n                this.playerGroups[group_code].full = false;\r\n                if (this.playerGroups[group_code].v_socketID) {\r\n                    this.io.to(this.playerGroups[group_code].v_socketID).emit('groupUpdate', this.playerGroups[group_code]);\r\n                }\r\n            } else {\r\n                this.playerGroups[group_code].v_playerID = null;\r\n                this.playerGroups[group_code].v_socketID = null;\r\n                this.playerGroups[group_code].v_playerName = null;\r\n                this.playerGroups[group_code].v_ready = false;\r\n                this.playerGroups[group_code].full = false;\r\n                if (this.playerGroups[group_code].c_socketID) {\r\n                    this.io.to(this.playerGroups[group_code].c_socketID).emit('groupUpdate', this.playerGroups[group_code]);\r\n                }\r\n            }\r\n\r\n            //console.log(this.playerGroups[group_code]);\r\n            if (this.playerGroups[group_code].c_socketID === null && this.playerGroups[group_code].v_socketID === null) {\r\n                //console.log(group_code + ' has been deleted.');\r\n                delete this.playerGroups[group_code];\r\n            }\r\n\r\n            if (this.playerGroups[group_code] && this.playerGroups[group_code].c_playerID && playerId !== this.playerGroups[group_code].c_playerID) {\r\n                for (let o of this.gameEngine.world.queryObjects({ playerId : this.playerGroups[group_code].c_playerID }))\r\n                    this.gameEngine.removeObjectFromWorld(o.id);\r\n            }\r\n        }\r\n        for (let o of this.gameEngine.world.queryObjects({ playerId }))\r\n            this.gameEngine.removeObjectFromWorld(o.id);\r\n\r\n    }\r\n}\r\n"],"file":"AsteroidsServerEngine.js"}