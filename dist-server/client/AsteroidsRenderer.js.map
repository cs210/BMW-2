{"version":3,"sources":["../../src/client/AsteroidsRenderer.js"],"names":["ctx","game","canvas","AsteroidsRenderer","gameEngine","clientEngine","document","createElement","width","window","innerWidth","devicePixelRatio","height","innerHeight","body","insertBefore","getElementById","w","h","zoom","spaceHeight","spaceWidth","getContext","lineWidth","strokeStyle","fillStyle","shadowBlur","shadowColor","viewer","groupShipPID","setTimeout","removeInstructions","bind","t","dt","clearRect","save","translate","scale","drawBounds","world","forEachObject","id","obj","Ship","drawShip","physicsObj","playerId","Bullet","drawBullet","FinishLine","drawFinishLine","Asteroid","drawAsteroid","updateStatus","restore","playerShip","queryObject","lives","undefined","classList","remove","innerHTML","won","add","special","radius","shapes","position","rotate","angle","beginPath","j","xv","vertices","yv","moveTo","lineTo","closePath","stroke","numAsteroidVerts","verts","arc","bulletRadius","Math","PI","fill","Renderer"],"mappings":"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","sourcesContent":["import { Renderer } from 'lance-gg';\nimport Asteroid from './../common/Asteroid';\nimport Bullet from './../common/Bullet';\nimport Ship from './../common/Ship';\nimport FinishLine from \"../common/FinishLine\";\n\nlet ctx = null;\nlet game = null;\nlet canvas = null;\n\nexport default class AsteroidsRenderer extends Renderer {\n\n    constructor(gameEngine, clientEngine) {\n        super(gameEngine, clientEngine);\n        game = gameEngine;\n\n        // Init canvas\n        canvas = document.createElement('canvas');\n        canvas.width = window.innerWidth * window.devicePixelRatio;\n        canvas.height = window.innerHeight * window.devicePixelRatio;\n        document.body.insertBefore(canvas, document.getElementById('logo'));\n        game.w = canvas.width;\n        game.h = canvas.height;\n        game.zoom = game.h / game.spaceHeight;\n        if (game.w / game.spaceWidth < game.zoom) game.zoom = game.w / game.spaceWidth;\n        ctx = canvas.getContext('2d');\n        ctx.lineWidth = 2 / game.zoom;\n        ctx.strokeStyle = ctx.fillStyle = 'white';\n        ctx.shadowBlur = 10;\n        ctx.shadowColor = \"white\";\n        this.viewer = false;\n        this.groupShipPID = null;\n        // remove instructions on first input\n        setTimeout(this.removeInstructions.bind(this), 5000);\n    }\n\n    draw(t, dt) {\n        super.draw(t, dt);\n\n        // Clear the canvas\n        ctx.clearRect(0, 0, game.w, game.h);\n\n        // Transform the canvas\n        // Note that we need to flip the y axis since Canvas pixel coordinates\n        // goes from top to bottom, while physics does the opposite.\n        ctx.save();\n        ctx.translate(game.w/2, game.h/2); // Translate to the center\n        ctx.scale(game.zoom, -game.zoom);  // Zoom in and flip y axis\n\n        // Draw all things\n        this.drawBounds();\n        game.world.forEachObject((id, obj) => {\n            if (obj instanceof Ship) this.drawShip(obj.physicsObj, obj.playerId === this.groupShipPID);\n            else if (obj instanceof Bullet) this.drawBullet(obj.physicsObj);\n            else if (obj instanceof FinishLine) this.drawFinishLine(obj.physicsObj);\n            else if (obj instanceof Asteroid && this.viewer) this.drawAsteroid(obj.physicsObj);\n        });\n\n        // update status and restore\n        this.updateStatus();\n        ctx.restore();\n    }\n\n    updateStatus() {\n\n        let playerShip = this.gameEngine.world.queryObject({ playerId: this.groupShipPID });\n\n        if (!playerShip) {\n            if (this.lives !== undefined)\n                document.getElementById('gameover').classList.remove('hidden');\n            return;\n        }\n\n        // update lives if necessary\n        if (playerShip.playerId === this.groupShipPID && this.lives !== playerShip.lives) {\n            document.getElementById('lives').innerHTML = 'Lives ' + playerShip.lives;\n            this.lives = playerShip.lives;\n        }\n\n        // update winning if necessary\n        if (playerShip.playerId === this.groupShipPID && playerShip.won) {\n            document.getElementById('gamewin').classList.remove('hidden');\n        }\n    }\n\n    removeInstructions() {\n        document.getElementById('instructions').classList.add('hidden');\n        document.getElementById('instructionsMobile').classList.add('hidden');\n    }\n\n    drawShip(body, special) {\n        let radius = body.shapes[0].radius;\n        if (special) {\n            ctx.strokeStyle = ctx.fillStyle = \"#18CAE6\";\n            ctx.shadowColor = \"#18CAE6\";\n        }\n        ctx.save();\n        ctx.translate(body.position[0], body.position[1]); // Translate to the ship center\n        ctx.rotate(body.angle); // Rotate to ship orientation\n        ctx.beginPath();\n        for(let j=0; j < 3; j++) {\n            let xv = body.shapes[0].vertices[j][0];\n            let yv = body.shapes[0].vertices[j][1];\n            if (j==0) ctx.moveTo(xv, yv);\n            else ctx.lineTo(xv, yv);\n        }\n        //ctx.moveTo(-radius*0.6, -radius);\n        //ctx.lineTo(0, radius);\n        //ctx.lineTo( radius*0.6, -radius);\n        //ctx.moveTo(-radius*0.5, -radius*0.5);\n        //ctx.lineTo( radius*0.5, -radius*0.5);\n        ctx.closePath();\n        ctx.stroke();\n        ctx.restore();\n        ctx.strokeStyle = ctx.fillStyle = 'white';\n        ctx.shadowColor = \"white\";\n    }\n\n\n\n    drawFinishLine(body) {\n        ctx.strokeStyle = ctx.fillStyle = \"#FAF602\";\n        ctx.shadowColor = \"#FAF602\";\n        ctx.save();\n        ctx.translate(body.position[0], body.position[1]);  // Translate to the center\n        //ctx.rotate(.785);\n        ctx.beginPath();\n        for(let j=0; j < game.numAsteroidVerts; j++) {\n            let xv = body.verts[j][0];\n            let yv = body.verts[j][1];\n            if (j==0) ctx.moveTo(xv, yv);\n            else ctx.lineTo(xv, yv);\n        }\n        ctx.closePath();\n        ctx.stroke();\n        ctx.restore();\n        ctx.strokeStyle = ctx.fillStyle = 'white';\n        ctx.shadowColor = \"white\";\n    }\n\n    drawAsteroid(body) {\n        ctx.save();\n        ctx.translate(body.position[0], body.position[1]);  // Translate to the center\n        ctx.beginPath();\n        for(let j=0; j < game.numAsteroidVerts; j++) {\n            let xv = body.verts[j][0];\n            let yv = body.verts[j][1];\n            if (j==0) ctx.moveTo(xv, yv);\n            else ctx.lineTo(xv, yv);\n        }\n        ctx.closePath();\n        ctx.stroke();\n        ctx.restore();\n    }\n\n    drawBullet(body) {\n        ctx.beginPath();\n        ctx.arc(body.position[0], body.position[1], game.bulletRadius, 0, 2*Math.PI);\n        ctx.fill();\n        ctx.closePath();\n    }\n\n    drawBounds() {\n        ctx.beginPath();\n        ctx.moveTo(-game.spaceWidth/2, -game.spaceHeight/2);\n        ctx.lineTo(-game.spaceWidth/2, game.spaceHeight/2);\n        ctx.lineTo( game.spaceWidth/2, game.spaceHeight/2);\n        ctx.lineTo( game.spaceWidth/2, -game.spaceHeight/2);\n        ctx.lineTo(-game.spaceWidth/2, -game.spaceHeight/2);\n        ctx.closePath();\n        ctx.stroke();\n    }\n\n}\n"],"file":"AsteroidsRenderer.js"}