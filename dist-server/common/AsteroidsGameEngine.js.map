{"version":3,"sources":["../../src/common/AsteroidsGameEngine.js"],"names":["AsteroidsGameEngine","options","physicsEngine","P2PhysicsEngine","gameEngine","world","defaultContactMaterial","friction","on","warpAll","bind","Object","assign","lives","shipSize","shipTurnSpeed","shipSpeed","bulletRadius","bulletLifeTime","asteroidRadius","numAsteroidLevels","numAsteroidVerts","maxAsteroidSpeed","spaceWidth","spaceHeight","SHIP","Math","pow","BULLET","ASTEROID","FINISHLINE","playerReady","forEachObject","id","obj","p","position","v","velocity","x","y","refreshToPhysics","serializer","registerClass","Ship","Asteroid","Bullet","FinishLine","inputData","playerId","playerShip","queryObject","instanceType","input","physicsObj","applyForce","emit","refreshFromPhysics","c_name","v_name","s","mass","angularVelocity","TwoVector","score","won","addObjectToWorld","console","log","min","max","floor","random","currentWorld","world_choice","getRandInt","world_one","world_two","world_three","world_four","a","level","queryObjects","o","removeObjectFromWorld","resetShip","ship","old_score","old_pid","addShipOnReset","asteroid","bullet","asteroidBody","r","b","c","d","GameEngine"],"mappings":"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","sourcesContent":["import { GameEngine, P2PhysicsEngine, TwoVector } from 'lance-gg';\r\nimport Asteroid from './Asteroid';\r\nimport Bullet from './Bullet';\r\nimport Ship from './Ship';\r\nimport FinishLine from \"./FinishLine\";\r\n\r\nexport default class AsteroidsGameEngine extends GameEngine {\r\n\r\n    constructor(options) {\r\n        super(options);\r\n\r\n        // create physics with no friction; wrap positions after each step\r\n        this.physicsEngine = new P2PhysicsEngine({ gameEngine: this });\r\n        this.physicsEngine.world.defaultContactMaterial.friction = 10;\r\n        this.on('postStep', this.warpAll.bind(this));\r\n\r\n        // game variables\r\n        Object.assign(this, {\r\n            lives: 0,\r\n            shipSize: 0.3,\r\n            shipTurnSpeed: 0.05,\r\n            shipSpeed: 4, // 2\r\n            bulletRadius: 0.03,\r\n            bulletLifeTime: 60,\r\n            asteroidRadius: 1.125,\r\n            numAsteroidLevels: 4,\r\n            numAsteroidVerts: 4,\r\n            maxAsteroidSpeed: 0,\r\n            spaceWidth: 16,\r\n            spaceHeight: 9,\r\n            SHIP: Math.pow(2, 1),\r\n            BULLET: Math.pow(2, 2),\r\n            ASTEROID: Math.pow(2, 3),\r\n            FINISHLINE: Math.pow(2, 4),\r\n        });\r\n\r\n        this.playerReady = {};\r\n    }\r\n\r\n    // If the body is out of space bounds, warp it to the other side\r\n    warpAll() {\r\n\r\n        this.world.forEachObject((id, obj) => {\r\n            let p = obj.position;\r\n            let v = obj.velocity;\r\n            if (p.x > this.spaceWidth/2) {\r\n                p.x = this.spaceWidth/2;\r\n                v.x = 0;\r\n            }\r\n            if (p.y > this.spaceHeight/2) {\r\n                p.y = this.spaceHeight/2;\r\n                v.y = 0;\r\n            }\r\n            if(p.x < -this.spaceWidth /2) {\r\n                p.x = -this.spaceWidth/2;\r\n                v.x = 0;\r\n            }\r\n            if(p.y < -this.spaceHeight/2) {\r\n                p.y = -this.spaceHeight/2;\r\n                v.y = 0;\r\n            }\r\n            obj.refreshToPhysics();\r\n        });\r\n\r\n    }\r\n\r\n    registerClasses(serializer) {\r\n        serializer.registerClass(Ship);\r\n        serializer.registerClass(Asteroid);\r\n        serializer.registerClass(Bullet);\r\n        serializer.registerClass(FinishLine);\r\n    }\r\n\r\n    processInput(inputData, playerId) {\r\n\r\n        super.processInput(inputData, playerId);\r\n\r\n        if (playerId in this.playerReady && this.playerReady[playerId]) {\r\n            // handle keyboard presses\r\n            let playerShip = this.world.queryObject({ playerId: playerId, instanceType: Ship });\r\n            if (playerShip) {\r\n                if (inputData.input === 'up') {\r\n                    playerShip.physicsObj.applyForce([0,-this.shipSpeed]);\r\n                    // playerShip.physicsObj.applyForceLocal([0,this.shipSpeed]);\r\n                } else if (inputData.input === 'right') {\r\n                    playerShip.physicsObj.applyForce([this.shipSpeed, 0]);\r\n                    // playerShip.physicsObj.angle -= this.shipTurnSpeed;\r\n                } else if (inputData.input === 'left') {\r\n                    playerShip.physicsObj.applyForce([-this.shipSpeed, 0]);\r\n                    // playerShip.physicsObj.angle += this.shipTurnSpeed;\r\n                } else if (inputData.input === 'down') {\r\n                    playerShip.physicsObj.applyForce([0,this.shipSpeed]);\r\n                    // playerShip.physicsObj.applyForceLocal([0,-this.shipSpeed]);\r\n                } else if (inputData.input === 'space') {\r\n                    this.emit('shoot', playerShip);\r\n                }\r\n\r\n                playerShip.refreshFromPhysics();\r\n            }\r\n        }\r\n    }\r\n\r\n    // create ship\r\n    addShip(playerId, c_name, v_name) {\r\n        let s = new Ship(this, {}, {\r\n            playerId: playerId,\r\n            mass: 10,\r\n            angularVelocity: 0,\r\n            position: new TwoVector(-6.4, -3.6),\r\n            velocity: new TwoVector(0, 0),\r\n        });\r\n        s.score = 0;\r\n        s.won = false;\r\n        s.c_name = c_name;\r\n        s.v_name = v_name;\r\n        this.addObjectToWorld(s);\r\n    }\r\n\r\n    addShipOnReset(playerId, c_name, v_name, score) {\r\n        let s = new Ship(this, {}, {\r\n            playerId: playerId,\r\n            mass: 10,\r\n            angularVelocity: 0,\r\n            position: new TwoVector(-6.4, -3.6),\r\n            velocity: new TwoVector(0, 0),\r\n        });\r\n        s.score = score;\r\n        console.log(\"score now: \"+ s.score);\r\n        s.won = false;\r\n        s.c_name = c_name;\r\n        s.v_name = v_name;\r\n        this.addObjectToWorld(s);\r\n    }\r\n\r\n    getRandInt(min, max) {\r\n        return Math.floor(Math.random() * (max - min)) + min;\r\n    }\r\n\r\n    // create asteroids\r\n    addBarriers(currentWorld) {\r\n        let world_choice = currentWorld;\r\n        while (world_choice === currentWorld) {\r\n            world_choice = this.getRandInt(1, 5);\r\n        }\r\n\r\n        if (world_choice === 1) {\r\n            this.world_one();\r\n        } else if (world_choice === 2) {\r\n            this.world_two();\r\n        } else if (world_choice === 3) {\r\n            this.world_three();\r\n        } else if (world_choice === 4) {\r\n            this.world_four();\r\n        }\r\n        return world_choice;\r\n    }\r\n\r\n    // Add finishline\r\n    addFinishLine() {\r\n        let a = new FinishLine(this, {}, {\r\n            mass: 10000,\r\n            position: new TwoVector(6.5, 3.75),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(1, 1));\r\n        a.level = 0;\r\n        this.addObjectToWorld(a);\r\n    }\r\n\r\n    removeAllBarriers() {\r\n        for (let o of this.world.queryObjects({ instanceType: Asteroid })) {\r\n            this.removeObjectFromWorld(o.id);\r\n        }\r\n        for (let o of this.world.queryObjects({ instanceType: FinishLine })) {\r\n            this.removeObjectFromWorld(o.id);\r\n        }\r\n    }\r\n\r\n    resetAllShips() {\r\n        for (let o of this.world.queryObjects({ instanceType: Ship })) {\r\n            this.resetShip(o)\r\n        }\r\n    }\r\n\r\n    resetShip(ship) {\r\n        let old_score = ship.score;\r\n        let c_name = ship.c_name;\r\n        let v_name = ship.v_name;\r\n        let old_pid = ship.playerId;\r\n        this.removeObjectFromWorld(ship.id);\r\n        this.addShipOnReset(old_pid, c_name, v_name, old_score);\r\n    }\r\n\r\n    // asteroid explosion\r\n    explode(asteroid, bullet) {\r\n        // Remove asteroid and bullet\r\n        let asteroidBody = asteroid.physicsObj;\r\n        let level = asteroid.level;\r\n        let x = asteroidBody.position[0];\r\n        let y = asteroidBody.position[1];\r\n        let r = this.asteroidRadius * (this.numAsteroidLevels - level) / this.numAsteroidLevels;\r\n        this.removeObjectFromWorld(asteroid);\r\n        this.removeObjectFromWorld(bullet);\r\n\r\n        // Add new sub-asteroids\r\n        /*\r\n        if (level < 3) {\r\n            let angleDisturb = Math.PI/2 * Math.random();\r\n            for (let i=0; i<4; i++) {\r\n                let angle = Math.PI/2 * i + angleDisturb;\r\n                let subAsteroid = new Asteroid(this, {}, {\r\n                    mass: 10,\r\n                    position: new TwoVector(x + r * Math.cos(angle), y + r * Math.sin(angle)),\r\n                    velocity: new TwoVector(0, 0)\r\n                });\r\n                subAsteroid.level = level + 1;\r\n                this.trace.info(() => `creating sub-asteroid with radius ${r}: ${subAsteroid.toString()}`);\r\n                this.addObjectToWorld(subAsteroid);\r\n            }\r\n        }\r\n        */\r\n    }\r\n\r\n    world_one() {\r\n        let a = new Asteroid(this, {}, {\r\n            mass: 100000,\r\n            position: new TwoVector(-5, -1.5),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(1, 3));\r\n        a.level = 0;\r\n        this.addObjectToWorld(a);\r\n    }\r\n\r\n    world_two() {\r\n        // add asteroids to the bottom half of the screen\r\n        let a = new Asteroid(this, {}, {\r\n            mass: 100000,\r\n            position: new TwoVector(-5, -1.5),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(1, 7));\r\n        a.level = 0;\r\n        this.addObjectToWorld(a);\r\n\r\n        // add asteroids to the bottom half of the screen\r\n        let b = new Asteroid(this, {}, {\r\n            mass: 100000,\r\n            position: new TwoVector(5, 1.5),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(1, 7));\r\n        b.level = 0;\r\n        this.addObjectToWorld(b);\r\n\r\n        let c = new Asteroid(this, {}, {\r\n            mass: 100000,\r\n            position: new TwoVector(0, 3),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(1, 4));\r\n        c.level = 0;\r\n        this.addObjectToWorld(c);\r\n\r\n        let d = new Asteroid(this, {}, {\r\n            mass: 100000,\r\n            position: new TwoVector(0, -3),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(1, 4));\r\n        d.level = 0;\r\n        this.addObjectToWorld(d);\r\n    }\r\n\r\n    world_three() {\r\n        // add asteroids to the bottom half of the screen\r\n        let a = new Asteroid(this, {}, {\r\n            mass: 100000,\r\n            position: new TwoVector(-1.5, -2),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(13, 1));\r\n        a.level = 0;\r\n        this.addObjectToWorld(a);\r\n\r\n        // add asteroids to the bottom half of the screen\r\n        let b = new Asteroid(this, {}, {\r\n            mass: 100000,\r\n            position: new TwoVector(1.5, 2),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(13, 1));\r\n        b.level = 0;\r\n        this.addObjectToWorld(b);\r\n    }\r\n\r\n    world_four() {\r\n        // add asteroids to the bottom half of the screen\r\n        let a = new Asteroid(this, {}, {\r\n            mass: 100000,\r\n            position: new TwoVector(-1.5, -2),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(13, 1));\r\n        a.level = 0;\r\n        this.addObjectToWorld(a);\r\n\r\n        let c = new Asteroid(this, {}, {\r\n            mass: 100000,\r\n            position: new TwoVector(0, 3),\r\n            velocity: new TwoVector(0, 0),\r\n            angularVelocity: 0\r\n        }, new TwoVector(1, 4));\r\n        c.level = 0;\r\n        this.addObjectToWorld(c);\r\n    }\r\n}\r\n"],"file":"AsteroidsGameEngine.js"}